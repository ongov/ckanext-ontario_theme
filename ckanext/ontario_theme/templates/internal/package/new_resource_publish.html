{% extends "package/base.html" %}



{% block primary_content_inner %}


<h1 class="ontario-h1">Step 4: Review and publish</h1>
RESOURCE_ID: {{resource_id}}

<div class="ontario-row">
    <div class="ontario-columns ontario-small-7">
        <h2 class="ontario-h2">Resource file and metadata</h2>
    </div>
    <div class="ontario-columns ontario-small-5">        
        {% link_for _('Edit resource file and metadata'), named_route='resource.edit', 
                                                          id=pkg.name,
                                                          resource_id=resource_id
        %}

    </div>
</div>



<div class="ontario-column ontario-small-12">
    <h3 class="ontario-h3">Resource file</h3>
</div>

<div class="ontario-column ontario-small-12">
  <h3 class="ontario-h3">Metadata</h3>
</div>

<div class="ontario-row">
    <div class="ontario-columns ontario-small-4">
        <h2 class="ontario-h2">Data dictionary</h2>
    </div>
    <div class="ontario-columns ontario-small-8">        
        {% link_for _('Edit data dictionary'), named_route='datastore.dictionary', 
                                                          id=pkg.name,
                                                          resource_id=resource_id
        %}
    </div>

    <div class="ontario-column ontario-small-12">
        {% set fields = h.datastore_dictionary(resource_id) %}
        {# Example of returned dictionary:

            [{'id': 'rule', 
              'type': 'text', 
              'info': {'label': '', 
                       'notes': '', 
                       'type_override': '', 
                       'frictionless_dict': [{'type': 'string', 'name': 'rule'}]}}, 
            {'id': 'integercol', 
             'type': 'int4', 
              'info': {'label': '', 
                       'notes': '', 
                       'type_override': 'integer', 
                       'frictionless_dict': [{'type': 'integer', 'name': 'integercol'}]}}]

            "type" is not human-readable for non-text types (e.g. int4), so use 
            field.info["type_override"] (e.g. integer) for these cases. Note we want to 
            stick with the PostgreSQL type names (e.g. "text" not "string") so don't use 
            field.info["frictionless_dict"]["type"]. 
        #}

        {% for field in fields %}
            <div>
                <h3 class="ontario-h3">Field {{ loop.index }}. {{ field.id }}</h3>
                <b>Type</b>                
                {% set field_type = field.type if field.info["type_override"] == '' else field.info["type_override"] %}
                <p>{{ field_type }}</p>
                {% if field.info["label"] %}
                    <b>Label</b>
                    <p>{{ field.info["label"] }}</p>
                {% endif %}
                {% if field.info["notes"] %}
                    <b>Description</b>
                    <p>{{ field.info["notes"] }}</p>
                {% endif %}
          </div>
        {% endfor %}

    </div>



</div>

    {% link_for _('Publish'), named_route='dataset.read', id=pkg.name, class_="ontario-button ontario-button--primary" %}
{% endblock primary_content_inner %}



{% block secondary %}

{% endblock secondary %}